# Generated by perlrpcgen.

INT=yppasswd_private
MOD=yppasswd_private
CC=cc
PERL=/opt/local/bin/perl
PERLRPCGEN=/public/bin/perlrpcgen
RPCLIBS=-lrpcsvc -lnsl
CFLAGS=-g

all: .perlmods $(MOD)/server/$(INT)_svc

.perlrpcgen: $(INT).x
	$(PERLRPCGEN) '--server' '--data' '--constants' '--perl' '/opt/local/bin/perl' -typemap \
	`$(PERL) -MConfig -e 'print "$$Config{privlib}/ExtUtils/typemap"'` \
	$(INT).x
	touch .perlrpcgen

.Makefiles: .perlrpcgen
	cd $(MOD); $(PERL) Makefile.PL
	touch .Makefiles

$(INT)_xdr.c $(INT)_clnt.c $(INT)_svc.c: $(INT).x
	rpcgen $(INT).x
	mv $(INT)_svc.c $(INT)_svc.c~
	sed -e "s/svc_run();/initperl(argc, argv); svc_run();/" \
	    -e "s/main()/main(int argc, char **argv)/" \
	    -e "s/for (i = 0;/\/*for (i=0;/" \
	    -e "s/(i, 2);/(i, 2);\*\//" \
	    -e "s/rqstp)/rqstp, transp)/" \
	    < $(INT)_svc.c~ > $(INT)_svc.c

.perlmods: .Makefiles $(INT)_xdr.o $(INT)_clnt.o
	cd $(MOD); make
	touch .perlmods

$(MOD)/server/$(INT)_svc: .perlrpcgen $(INT)_svc.o
	cd $(MOD)/server; make $(INT)_svc

tidy:
	rm -f *~ "#*" core

clean: tidy
	rm -f .perlrpcgen .Makefiles .perlmods
	rm -f *.h *.c *.o
	rm -rf $(MOD)

install: all
	cd $(MOD); make install
